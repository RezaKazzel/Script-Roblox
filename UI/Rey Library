local ReyUILib = {}

function ReyUILib:CreateUI(uiName)
    local CoreGui = game:GetService("CoreGui")

    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = uiName or "ReyUI"
    screenGui.Parent = CoreGui
    screenGui.ResetOnSpawn = false

    local ReyBtn = Instance.new("TextButton")
    ReyBtn.Size = UDim2.new(0, 70, 0, 30)
    ReyBtn.Position = UDim2.new(1, -80, 0, 10)
    ReyBtn.BackgroundColor3 = Color3.fromRGB(148, 0, 211)
    ReyBtn.Text = "Rey"
    ReyBtn.TextColor3 = Color3.new(1, 1, 1)
    ReyBtn.BorderSizePixel = 0
    ReyBtn.Font = Enum.Font.GothamBold
    ReyBtn.TextSize = 14
    ReyBtn.Parent = screenGui
    ReyBtn.Active = true
    ReyBtn.Draggable = true

    local panel = Instance.new("Frame")
    panel.Size = UDim2.new(0, 500, 0, 350)
    panel.Position = UDim2.new(0.5, -250, 0.5, -175)
    panel.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    panel.BorderSizePixel = 0
    panel.Visible = false
    panel.Parent = screenGui
    panel.Active = true
    panel.Draggable = true

    local header = Instance.new("TextLabel")
    header.Size = UDim2.new(1, 0, 0, 30)
    header.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    header.Text = uiName or "Rey UI"
    header.TextColor3 = Color3.fromRGB(255, 255, 255)
    header.BorderSizePixel = 0
    header.Font = Enum.Font.GothamBold
    header.TextSize = 16
    header.TextXAlignment = Enum.TextXAlignment.Center
    header.Parent = panel

    local leftFrame = Instance.new("Frame")
    leftFrame.Size = UDim2.new(0, 130, 1, -30)
    leftFrame.Position = UDim2.new(0, 0, 0, 30)
    leftFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
    leftFrame.BorderSizePixel = 0
    leftFrame.Parent = panel

    local tabContainer = Instance.new("Frame")
    tabContainer.Size = UDim2.new(1, 0, 1, 0)
    tabContainer.BackgroundTransparency = 1
    tabContainer.Parent = leftFrame

    local tabLayout = Instance.new("UIListLayout")
    tabLayout.FillDirection = Enum.FillDirection.Vertical
    tabLayout.Padding = UDim.new(0, 5)
    tabLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    tabLayout.VerticalAlignment = Enum.VerticalAlignment.Top
    tabLayout.Parent = tabContainer

    local rightFrame = Instance.new("Frame")
    rightFrame.Size = UDim2.new(1, -130, 1, -30)
    rightFrame.Position = UDim2.new(0, 130, 0, 30)
    rightFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    rightFrame.BorderSizePixel = 0
    rightFrame.Parent = panel

    ReyBtn.MouseButton1Click:Connect(function()
        panel.Visible = not panel.Visible
    end)

    return {
        ScreenGui = screenGui,
        Panel = panel,
        LeftFrame = leftFrame,
        RightFrame = rightFrame,
        TabContainer = tabContainer,
    }
end

function ReyUILib:AddTab(UI, tabName)
    local tabButton = Instance.new("TextButton")
    tabButton.Size = UDim2.new(1, -10, 0, 25)
    tabButton.BackgroundColor3 = Color3.fromRGB(85, 85, 255)
    tabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    tabButton.Font = Enum.Font.GothamBold
    tabButton.TextSize = 14
    tabButton.Text = tabName
    tabButton.BorderSizePixel = 0
    tabButton.Parent = UI.TabContainer

    local tabContent = Instance.new("Frame")
    tabContent.Size = UDim2.new(1, 0, 1, 0)
    tabContent.BackgroundTransparency = 1
    tabContent.Visible = false
    tabContent.Parent = UI.RightFrame
    
    if not tabContent:FindFirstChild("UIListLayout") then
	    local layout = Instance.new("UIListLayout")
	    layout.Padding = UDim.new(0, 5) -- Jarak antar tombol
	    layout.FillDirection = Enum.FillDirection.Vertical
	    layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	    layout.VerticalAlignment = Enum.VerticalAlignment.Top
	    layout.SortOrder = Enum.SortOrder.LayoutOrder
	    layout.Parent = tabContent
	end

    tabButton.MouseButton1Click:Connect(function()
        for _, tab in ipairs(UI.RightFrame:GetChildren()) do
            if tab:IsA("Frame") then
                tab.Visible = false
            end
        end
        tabContent.Visible = true
    end)

    return tabContent
end

function ReyUILib:CreateButton(parent, name, description, buttonText, callback)
    local buttonFrame = Instance.new("Frame")
    buttonFrame.Size = UDim2.new(1, -10, 0, 50)
    buttonFrame.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    buttonFrame.BorderSizePixel = 2
    buttonFrame.BorderColor3 = Color3.fromRGB(30, 30, 30)
    buttonFrame.Parent = parent

    local buttonName = Instance.new("TextLabel")
    buttonName.Size = UDim2.new(0.7, 0, 0.5, 0)
    buttonName.Position = UDim2.new(0, 10, 0, 5)
    buttonName.BackgroundTransparency = 1
    buttonName.Text = name
    buttonName.TextColor3 = Color3.fromRGB(255, 255, 255)
    buttonName.Font = Enum.Font.GothamBold
    buttonName.TextSize = 14
    buttonName.TextXAlignment = Enum.TextXAlignment.Left
    buttonName.Parent = buttonFrame

    local buttonDesc = Instance.new("TextLabel")
    buttonDesc.Size = UDim2.new(0.7, 0, 0.3, 0)
    buttonDesc.Position = UDim2.new(0, 10, 0, 30)
    buttonDesc.BackgroundTransparency = 1
    buttonDesc.Text = description
    buttonDesc.TextColor3 = Color3.fromRGB(180, 180, 180)
    buttonDesc.Font = Enum.Font.Gotham
    buttonDesc.TextSize = 12
    buttonDesc.TextXAlignment = Enum.TextXAlignment.Left
    buttonDesc.Parent = buttonFrame

    local actionButton = Instance.new("TextButton")
    actionButton.Size = UDim2.new(0, 65, 0, 25)
    actionButton.Position = UDim2.new(1, -70, 0, 12)
    actionButton.BackgroundColor3 = Color3.fromRGB(85, 85, 255)
    actionButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    actionButton.Font = Enum.Font.GothamBold
    actionButton.TextSize = 14
    actionButton.Text = buttonText
    actionButton.BorderSizePixel = 0
    actionButton.Parent = buttonFrame

    actionButton.MouseButton1Click:Connect(callback)
end

function ReyUILib:CreateToggle(parent, name, description, callback)
    local buttonFrame = Instance.new("Frame")
    buttonFrame.Size = UDim2.new(1, -10, 0, 50)
    buttonFrame.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    buttonFrame.BorderSizePixel = 2
    buttonFrame.BorderColor3 = Color3.fromRGB(30, 30, 30)
    buttonFrame.Parent = parent

    local buttonName = Instance.new("TextLabel")
    buttonName.Size = UDim2.new(0.7, 0, 0.5, 0)
    buttonName.Position = UDim2.new(0, 10, 0, 5)
    buttonName.BackgroundTransparency = 1
    buttonName.Text = name
    buttonName.TextColor3 = Color3.fromRGB(255, 255, 255)
    buttonName.Font = Enum.Font.GothamBold
    buttonName.TextSize = 14
    buttonName.TextXAlignment = Enum.TextXAlignment.Left
    buttonName.Parent = buttonFrame

    local buttonDesc = Instance.new("TextLabel")
    buttonDesc.Size = UDim2.new(0.7, 0, 0.3, 0)
    buttonDesc.Position = UDim2.new(0, 10, 0, 30)
    buttonDesc.BackgroundTransparency = 1
    buttonDesc.Text = description
    buttonDesc.TextColor3 = Color3.fromRGB(180, 180, 180)
    buttonDesc.Font = Enum.Font.Gotham
    buttonDesc.TextSize = 12
    buttonDesc.TextXAlignment = Enum.TextXAlignment.Left
    buttonDesc.Parent = buttonFrame

    local toggleContainer = Instance.new("Frame")
    toggleContainer.Size = UDim2.new(0, 60, 0, 25)
    toggleContainer.Position = UDim2.new(1, -70, 0, 12)
    toggleContainer.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    toggleContainer.BorderSizePixel = 0
    toggleContainer.Parent = buttonFrame

    local toggleCircle = Instance.new("Frame")
    toggleCircle.Size = UDim2.new(0, 20, 0, 20)
    toggleCircle.Position = UDim2.new(0, 2, 0, 2)
    toggleCircle.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    toggleCircle.BorderSizePixel = 0
    toggleCircle.Parent = toggleContainer

    local isToggled = false

    -- Callback default
    callback = callback or function() end

    local function toggle()
        isToggled = not isToggled
        if isToggled then
            toggleCircle:TweenPosition(UDim2.new(1, -22, 0, 2), Enum.EasingDirection.InOut, Enum.EasingStyle.Quad, 0.2, true)
            toggleCircle.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
        else
            toggleCircle:TweenPosition(UDim2.new(0, 2, 0, 2), Enum.EasingDirection.InOut, Enum.EasingStyle.Quad, 0.2, true)
            toggleCircle.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
        end
        callback(isToggled)
    end

    toggleContainer.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            toggle()
        end
    end)

    return buttonFrame
end

function ReyUILib:CreateDropdown(parent, name, options, callback)
    callback = callback or function() end

    local dropdownFrame = Instance.new("Frame")
    dropdownFrame.Size = UDim2.new(1, -10, 0, 40)
    dropdownFrame.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    dropdownFrame.BorderSizePixel = 2
    dropdownFrame.BorderColor3 = Color3.fromRGB(30, 30, 30)
    dropdownFrame.Parent = parent

    local dropdownButton = Instance.new("TextButton")
    dropdownButton.Size = UDim2.new(1, 0, 1, 0)
    dropdownButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    dropdownButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    dropdownButton.Font = Enum.Font.GothamBold
    dropdownButton.TextSize = 14
    dropdownButton.Text = name
    dropdownButton.BorderSizePixel = 0
    dropdownButton.Parent = dropdownFrame

    local dropdownList = Instance.new("ScrollingFrame")
    dropdownList.Size = UDim2.new(1, 0, 0, 150)
    dropdownList.Position = UDim2.new(0, 0, 1, 0)
    dropdownList.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    dropdownList.BorderSizePixel = 0
    dropdownList.Visible = false
    dropdownList.ClipsDescendants = true
    dropdownList.ScrollBarThickness = 6
    dropdownList.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 100)
    dropdownList.ZIndex = 2 -- Prioritas render lebih tinggi
    dropdownList.Parent = dropdownFrame

    local dropdownLayout = Instance.new("UIListLayout")
    dropdownLayout.FillDirection = Enum.FillDirection.Vertical
    dropdownLayout.Padding = UDim.new(0, 5)
    dropdownLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    dropdownLayout.Parent = dropdownList

    local function updateCanvasSize()
        dropdownList.CanvasSize = UDim2.new(0, 0, 0, dropdownLayout.AbsoluteContentSize.Y)
    end

    dropdownLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(updateCanvasSize)

    local function createOption(option)
        local optionButton = Instance.new("TextButton")
        optionButton.Size = UDim2.new(1, -10, 0, 30)
        optionButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
        optionButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        optionButton.Font = Enum.Font.Gotham
        optionButton.TextSize = 12
        optionButton.Text = option
        optionButton.BorderSizePixel = 0
        optionButton.ZIndex = 2
        optionButton.Parent = dropdownList

        optionButton.MouseButton1Click:Connect(function()
            dropdownButton.Text = option
            dropdownList.Visible = false
            callback(option)
        end)
    end

    for _, option in ipairs(options) do
        createOption(option)
    end

    dropdownButton.MouseButton1Click:Connect(function()
        dropdownList.Visible = not dropdownList.Visible
    end)

    updateCanvasSize()
    return dropdownFrame
end

return ReyUILib
