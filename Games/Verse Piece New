local VirtualUser = game:GetService("VirtualUser")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character
local HumanoidRootPart = Character and Character:FindFirstChild("HumanoidRootPart")
local Torso = Character and (Character:FindFirstChild("Torso") or Character:FindFirstChild("LowerTorso"))

local Rey = loadstring(game:HttpGet("https://raw.githubusercontent.com/RezaKazzel/Script-Roblox/refs/heads/main/UI/Rey%20Library%20New"))()
local UI = Rey:CreateUI("nihao")
local Exclusive = Rey:CreateTab(UI, "Exclusive+")

local activeConnections = {}
local miaw = 0
local SGoblet = nil
local debounce = false

local function simulateKeyPress(key)
    VirtualUser:CaptureController()
    VirtualUser:SetKeyDown(key:lower())
    VirtualUser:SetKeyUp(key:lower())
end

local function simulateAttack()
    VirtualUser:CaptureController()
    VirtualUser:Button1Down(Vector2.new(0, 1, 0, 1))
    VirtualUser:Button1Up(Vector2.new(0, 1, 0, 1))
end

local function setBodyVelocity(enabled)
    if not Torso then return end
    if enabled and not Torso:FindFirstChild("BodyVelocity") then
        local bv = Instance.new("BodyVelocity", Torso)
        bv.velocity = Vector3.new(0, 0.1, 0)
        bv.maxForce = Vector3.new(9e9, 9e9, 9e9)
    elseif not enabled and Torso:FindFirstChild("BodyVelocity") then
        Torso:FindFirstChild("BodyVelocity"):Destroy()
    end
end

local function moveTo(targetCFrame)
    if HumanoidRootPart then
        HumanoidRootPart.CFrame = targetCFrame
    end
end

local function findNearestTarget(path)
    if not path then return nil end
    for _, child in ipairs(path:GetChildren()) do
        if child:IsA("Model") then
            local humanoid = child:FindFirstChildOfClass("Humanoid")
            local rootPart = child:FindFirstChild("HumanoidRootPart")
            if humanoid and rootPart and humanoid.Health > 0 then
                return child
            end
        end
    end
    return nil
end

-- Auto Vasto Lorde
local function autoVastoLorde()
    if not debounce then
        local npc = workspace.Npc.Quest["Quest 15"]
        if npc and npc.ProximityPrompt then
            npc.ProximityPrompt.HoldDuration = 0
            moveTo(npc.HumanoidRootPart.CFrame)
            for i = 1, 5 do task.wait() simulateKeyPress("E") end
            debounce = true
            task.spawn(function() task.wait(3) debounce = false end)
        end
    end

    local vastoLorde = findNearestTarget(workspace.Main.Kurakura["Vasto Lorde"])
    if vastoLorde then
        local targetPosition = vastoLorde.HumanoidRootPart.Position + Vector3.new(0, vastoLorde.HumanoidRootPart.Size.Y / 2 + 4, 0)
        moveTo(CFrame.new(targetPosition, targetPosition - Vector3.new(0, 1, 0)))
    end
end

Rey:CreateToggle(Exclusive, "Auto Vasto Lorde", "-", function(state)
    _G.AutoLevel = state
    setBodyVelocity(state)
    activeConnections["AutoVastoLorde"] = state and RunService.Heartbeat:Connect(autoVastoLorde) or (activeConnections["AutoVastoLorde"] and activeConnections["AutoVastoLorde"]:Disconnect())
end)

-- Auto Bosses
local function autoBosses()
    local target = findNearestTarget(workspace.Main.Boss) or findNearestTarget(workspace.Main.RaidBoss) or findNearestTarget(workspace.Main.Valentine)
    if target then
        local targetPosition = target.HumanoidRootPart.Position + Vector3.new(0, target.HumanoidRootPart.Size.Y / 2 + 4, 0)
        moveTo(CFrame.new(targetPosition, targetPosition - Vector3.new(0, 1, 0)))
    end
end

Rey:CreateToggle(Exclusive, "Auto Bosses", "auto semua boss", function(state)
    _G.AutoBosses = state
    setBodyVelocity(state)
    activeConnections["AutoBosses"] = state and RunService.Heartbeat:Connect(autoBosses) or (activeConnections["AutoBosses"] and activeConnections["AutoBosses"]:Disconnect())
end)

Rey:CreateNote(Exclusive, "Last Update -- Valentine D4C Boss\nCuma World Boss yang bisa, okarun ga ngespawn otomatis jadinya gbisa")
Rey:CreateNote(Exclusive, "-- Misc")

-- Auto Mission
local function autoMission()
    local missionStatus = LocalPlayer.MissionData.Active.Value
    if not missionStatus then
        miaw = miaw + 1
        local megumi = workspace.Npc.Quest.Mission
        if megumi and megumi.HumanoidRootPart and megumi.ProximityPrompt then
            moveTo(megumi.HumanoidRootPart.CFrame)
            megumi.ProximityPrompt.HoldDuration = 0
            task.wait(0.1)
            simulateKeyPress("E")
            if miaw > 5 then task.wait(1) miaw = 0 end
        end
        return
    end

    local questTitle = LocalPlayer.MissionData["Quest Title"].Value
    local questActions = {
        ["Curse object"] = function() moveTo(workspace.Main["Mission Quest"]["1"]:GetChildren()[6].HumanoidRootPart.CFrame); for i = 1, 10 do simulateKeyPress("E") end end,
        ["Civilains"] = function() moveTo(workspace.Main["Mission Quest"]["4"]:GetChildren()[4].HumanoidRootPart.CFrame); for i = 1, 10 do simulateKeyPress("E") end end,
        ["Goblet"] = function() moveTo(CFrame.new(-4941.32715, 8.59784603, 3310.08887, 1, 0, 0, 0, 1, 0, 0, 0, 1)); for i = 1, 770 do simulateKeyPress("E") end; SGoblet = true end,
        ["Shadow Portal"] = function() moveTo(workspace.Main["Mission Quest"]["5"]:GetChildren()[4].CFrame); for i = 1, 770 do simulateKeyPress("E") end end,
        ["Curse Spirit"] = function() autoMob("Curse Spirit", true) end,
        ["Lightning Sorceror"] = function() autoMob("Kashimo", true) end,
    }

    for questName, action in pairs(questActions) do
        if questTitle:find(questName) then
            action()
            return
        end
    end
end

Rey:CreateToggle(Exclusive, "Auto Mission (Lvl. 1.000+)", "-", function(state)
    _G.AutoMissions = state
    for _, prompt in ipairs(workspace.Main["Mission Quest"]:GetDescendants()) do
        if prompt:IsA("ProximityPrompt") then prompt.HoldDuration = 0 end
    end
    setBodyVelocity(state)
    activeConnections["AutoMissions"] = state and RunService.Heartbeat:Connect(function() SGoblet = nil; autoMission() end) or (activeConnections["AutoMissions"] and activeConnections["AutoMissions"]:Disconnect())
end)

-- Auto Mob
local function autoMob(mob, state)
    local target = workspace.Main.Forest:FindFirstChild(mob)
    if target and state then
        setBodyVelocity(true)
        activeConnections["AutoMob" .. mob] = RunService.Heartbeat:Connect(function()
            if not target then
                activeConnections["AutoMob" .. mob]:Disconnect()
                activeConnections["AutoMob" .. mob] = nil
                setBodyVelocity(false)
                return
            end
            for _, child in ipairs(target:GetChildren()) do
                if child:IsA("Model") and child:FindFirstChild("HumanoidRootPart") and child.Humanoid.Health > 0 then
                    local targetPosition = child.HumanoidRootPart.Position + Vector3.new(0, child.HumanoidRootPart.Size.Y / 2 + 3, 0)
                    moveTo(CFrame.new(targetPosition, targetPosition - Vector3.new(0, 1, 0)))
                    simulateAttack()
                    break
                end
            end
        end)
    elseif activeConnections["AutoMob" .. mob] then
        activeConnections["AutoMob" .. mob]:Disconnect()
        activeConnections["AutoMob" .. mob] = nil
        setBodyVelocity(false)
    end
end

-- Adventure Shop Teleport
Rey:CreateButton(Exclusive, "Adventure Shop", "kalo ga ke tp berarti gada", "Teleport", function()
    local adventureShop = workspace.Npc["Adventure Shop"]["Adventure Shop"]
    if adventureShop and adventureShop.HumanoidRootPart then
        moveTo(adventureShop.HumanoidRootPart.CFrame)
    end
end)

-- Farm Gems
local function farmGems()
    if not SGoblet then
        autoMission()
    else
        setBodyVelocity(false)
        local adventureShop = workspace.Npc["Adventure Shop"]["Adventure Shop"]
        if adventureShop and adventureShop.HumanoidRootPart and adventureShop.HumanoidRootPart.ProximityPrompt then
            adventureShop.HumanoidRootPart.ProximityPrompt.HoldDuration = 0
            moveTo(adventureShop.HumanoidRootPart.CFrame)
            task.wait(0.1)
            simulateKeyPress("E")
            local args = {[1] = "750"}
            pcall(function()
                LocalPlayer.PlayerGui:FindFirstChild("Adventure Store").Main.Iinv:FindFirstChild("{}").Events:FireServer(unpack(args))
            end)
            moveTo(CFrame.new(-4941.32715, 8.59784603, 3310.08887, 1, 0, 0, 0, 1, 0, 0, 0, 1))
            task.wait(0.1)
            for i = 1, 770 do simulateKeyPress("E") end
            task.wait(3)
        end
        SGoblet = nil
    end
end

Rey:CreateToggle(Exclusive, "Farm Gems", "jual sendiri Goblet nya wak<0xF0><0x9F><0xA7><0xB3>", function(state)
    _G.FarmGems = state
    for _, prompt in ipairs(workspace.Main["Mission Quest"]:GetDescendants()) do
        if prompt:IsA("ProximityPrompt") then prompt.HoldDuration = 0 end
    end
    setBodyVelocity(state)
    activeConnections["FarmGems"] = state and RunService.Heartbeat:Connect(farmGems) or (activeConnections["FarmGems"] and activeConnections["FarmGems"]:Disconnect())
end)

-- Auto Goblet (Manual Click)
Rey:CreateButton(Exclusive, "Auto Goblet [Manual Click]", "farm diamond cik", "Start", function()
    moveTo(CFrame.new(-4941.32715, 8.59784603, 3310.08887, 1, 0, 0, 0, 1, 0, 0, 0, 1))
    task.wait(0.1)
    for i = 1, 750 do simulateKeyPress("E") end
end)

-- Auto Buy Black Merchant (Slow)
Rey:CreateToggle(Exclusive, "Auto Buy Black Merchant (Slow)", "Auto TP, Auto Buy", function(state)
    _G.AutoBM1 = state
    setBodyVelocity(state)
    activeConnections["AutoBM1"] = state and RunService.Heartbeat:Connect(function()
        local blackMerchant = workspace.Npc["Black Merchant"]["Black Merchant"]
        if blackMerchant and blackMerchant.HumanoidRootPart then
            moveTo(blackMerchant.HumanoidRootPart.CFrame)
            simulateKeyPress("E")
        end
    end) or (activeConnections["AutoBM1"] and activeConnections["AutoBM1"]:Disconnect())
end)

-- Auto Buy Black Merchant (Fast)
Rey:CreateToggle(Exclusive, "Auto Buy Black Merchant (Fast)", "kalo lag ga nanggung", function(state)
    _G.AutoBM2 = state
    setBodyVelocity(state)
    activeConnections["AutoBM2"] = state and RunService.Heartbeat:Connect(function()
        local blackMerchant = workspace.Npc["Black Merchant"]["Black Merchant"]
        if blackMerchant and blackMerchant.HumanoidRootPart then
            moveTo(blackMerchant.HumanoidRootPart.CFrame)
            simulateKeyPress("E")
        end
    end) or (activeConnections["AutoBM2"] and activeConnections["AutoBM2"]:Disconnect())
end)

-- Auto Buy Black Merchant (BROKEN)
Rey:CreateToggle(Exclusive, "Auto Buy Black Merchant (BROKEN)", "<0xF0><0x9F><0x91><0xB6>", function(state)
    _G.AutoBM3 = state
    setBodyVelocity(state)
    activeConnections["AutoBM3"] = state and RunService.Heartbeat:Connect(function()
        local blackMerchant = workspace.Npc["Black Merchant"]["Black Merchant"]
        if blackMerchant and blackMerchant.HumanoidRootPart then
            moveTo(blackMerchant.HumanoidRootPart.CFrame)
            for i = 1, 1000 do simulateKeyPress("E") end
        end
    end) or (activeConnections["AutoBM3"] and activeConnections["AutoBM3"]:Disconnect())
end)
