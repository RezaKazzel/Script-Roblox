local VirtualUser = game:GetService("VirtualUser")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local Rey = loadstring(game:HttpGet("https://raw.githubusercontent.com/RezaKazzel/Script-Roblox/refs/heads/main/UI/Rey%20Library%20New"))()
local Exclusive = Rey:CreateTab(UI, "Exclusive+")

local activeConnections = {}
local miaw = 0
local sGoblet = nil
local selectedWeapon = nil
local currentPriority = nil
local skills = {"Z", "X", "C", "V", "F"}
local selectedSkills = {}

local function getCharacterParts()
	local Character = LocalPlayer.Character
	if not Character then return nil, nil end
	local HumanoidRootPart = Character:FindFirstChild("HumanoidRootPart")
	local Torso = Character:FindFirstChild("Torso") or Character:FindFirstChild("LowerTorso")
	return HumanoidRootPart, Torso
end

local function pressKey(key)
	pcall(function()
		VirtualUser:CaptureController()
		VirtualUser:SetKeyDown(key:lower())
		VirtualUser:SetKeyUp(key:lower())
	end)
end

local function AutoSkill()
	if #selectedSkills > 0 then
		pcall(function()
			for _, skill in ipairs(selectedSkills) do
				pressKey(skill)
			end
		end)
	end
end

local function attack()
	pcall(function()
		VirtualUser:CaptureController()
		VirtualUser:Button1Down(Vector2.new(0, 1, 0, 1))
		VirtualUser:Button1Up(Vector2.new(0, 1, 0, 1))
	end)
end

local function move(targetCFrame)
	local HumanoidRootPart, _ = getCharacterParts()
	if HumanoidRootPart then
		pcall(function()
			HumanoidRootPart.CFrame = targetCFrame
		end)
	end
end

local function findTarget(path)
	if not path then return nil end
	local result
	local success, err = pcall(function()
		for _, child in ipairs(path:GetChildren()) do
			if child:IsA("Model") and child:FindFirstChildOfClass("Humanoid") and child:FindFirstChild("HumanoidRootPart") and child.Humanoid.Health > 0 then
				result = child
				return
			end
		end
	end)
	if not success then warn("Error in findTarget:", err) return nil end
	return result
end

local function setBodyVelocity(enabled)
	local _, Torso = getCharacterParts()
	if not Torso then return end
	pcall(function()
		local bodyVelocity = Torso:FindFirstChild("BodyVelocity")
		if enabled and not bodyVelocity then
			local newBodyVelocity = Instance.new("BodyVelocity", Torso)
			newBodyVelocity.velocity = Vector3.new(0, 0.1, 0)
			newBodyVelocity.maxForce = Vector3.new(9e9, 9e9, 9e9)
		elseif not enabled and bodyVelocity then
			bodyVelocity:Destroy()
		end
	end)
end

local function Weapons()
	local backpack = {}
	local backpackFolder = LocalPlayer:FindFirstChild("Backpack")
	if backpackFolder then
		for _, item in ipairs(backpackFolder:GetChildren()) do
			if item:IsA("Tool") then
				table.insert(backpack, item)
			end
		end
		return backpack
	end
end

Rey:CreateDropdown(Exclusive, "Pilih senjata", Weapons, function(weapon)
	selectedWeapon = weapon
	if selectedWeapon then
		selectedWeapon.Parent = LocalPlayer.Character
	end
end, true)

Rey:CreateMultipleDropdown(Exclusive, "Auto Skill", skills, function(selected)
	selectedSkills = selected
end)

-- Auto Vasto Lorde
Rey:CreateToggle(Exclusive, "Auto Vasto Lorde", "-", function(state)
	_G.AutoLevel = state
	if _G.AutoLevel then
		activeConnections["AutoLevel"] = RunService.Heartbeat:Connect(function()
			if currentPriority == "Boss" then return end
			
			local questNpc = workspace.Npc.Quest["Quest 15"]
			if questNpc and questNpc.ProximityPrompt and not debounce then
				debounce = true
				questNpc.ProximityPrompt.HoldDuration = 0
				move(questNpc.HumanoidRootPart.CFrame)
				for i = 1, 5 do task.wait() pressKey("E") end
				task.spawn(function() task.wait(3) debounce = false end)
			end

			local vastoLorde = findTarget(workspace.Main.Kurakura["Vasto Lorde"])
			if vastoLorde then
				currentPriority = "VastoLorde"
				setBodyVelocity(true)
				local targetPosition = vastoLorde.HumanoidRootPart.Position + Vector3.new(0, vastoLorde.HumanoidRootPart.Size.Y / 2 + 4, 0)
				move(CFrame.new(targetPosition, targetPosition - Vector3.new(0, 1, 0)))
				if selectedWeapon then
					selectedWeapon.Parent = LocalPlayer.Character
					selectedWeapon:Activate()
				end
				AutoSkill()
				pcall(function()
					if vastoLorde.Humanoid.Health < vastoLorde.Humanoid.MaxHealth * 0.8 then
						vastoLorde.Humanoid.Health = 0
						task.spawn(function()
							while vastoLorde and vastoLorde:FindFirstChild("Humanoid") and vastoLorde.Humanoid.Health <= 0 do
								pcall(function()
									vastoLorde.Humanoid.Health = 1
									task.wait(1)
									vastoLorde.Humanoid.Health = 0
									task.wait(1)
								end)
							end
						end)
					end
				end)
			else
				currentPriority = nil
				setBodyVelocity(false)
			end
		end)
	else
		if activeConnections["AutoLevel"] then
			activeConnections["AutoLevel"]:Disconnect()
			activeConnections["AutoLevel"] = nil
		end
	end
end)

-- Auto Bosses
Rey:CreateToggle(Exclusive, "Auto Bosses", "auto semua boss", function(state)
	_G.AutoBosses = state
	if _G.AutoBosses then
		activeConnections["AutoBosses"] = RunService.Heartbeat:Connect(function()
			if currentPriority == "VastoLorde" then return end

			local targetBoss = findTarget(workspace.Main.Boss) or findTarget(workspace.Main.RaidBoss) or findTarget(workspace.Main.Valentine)
			if targetBoss then
				currentPriority = "Boss"
				setBodyVelocity(true)
				local targetPosition = targetBoss.HumanoidRootPart.Position + Vector3.new(0, targetBoss.HumanoidRootPart.Size.Y / 2 + 4, 0)
				move(CFrame.new(targetPosition, targetPosition - Vector3.new(0, 1, 0)))
				if selectedWeapon then
					selectedWeapon.Parent = LocalPlayer.Character
					selectedWeapon:Activate()
				end
				AutoSkill()
				if targetBoss.Humanoid.Health < targetBoss.Humanoid.MaxHealth * 0.8 then
					targetBoss.Humanoid.Health = 0
					task.spawn(function()
						while targetBoss and targetBoss:FindFirstChild("Humanoid") and targetBoss.Humanoid.Health <= 0 do
						pcall(function()
							targetBoss.Humanoid.Health = 1
							task.wait(1)
							targetBoss.Humanoid.Health = 0
							task.wait(1)
						end)
						end
					end)
				end
			else
				if currentPriority == "Boss" then currentPriority = nil end
				setBodyVelocity(false)
			end
		end)
	else
		if activeConnections["AutoBosses"] then
			activeConnections["AutoBosses"]:Disconnect()
			activeConnections["AutoBosses"] = nil
		end
	end
end)

Rey:CreateNote(Exclusive, "Last Update -- Valentine D4C Boss\nCuma World Boss yang bisa, okarun ga ngespawn otomatis jadinya gbisa")
Rey:CreateNote(Exclusive, "-- Misc")

-- Auto Mission
local function runAutoMission()
	sGoblet = nil
	local missionStatus = LocalPlayer.MissionData.Active.Value
	if not missionStatus then
		miaw = miaw + 1
		local questNpc = workspace.Npc.Quest.Mission
		if questNpc and questNpc.HumanoidRootPart then
			move(questNpc.HumanoidRootPart.CFrame)
			questNpc.ProximityPrompt.HoldDuration = 0
			task.wait(0.1)
			pressKey("E")
			if miaw > 5 then task.wait(1) miaw = 0 end
		end
		return
	end

	local questTitle = LocalPlayer.MissionData["Quest Title"].Value
	local questActions = {
		["Curse object"] = function() move(workspace.Main["Mission Quest"]["1"]:GetChildren()[6].HumanoidRootPart.CFrame); for i = 1, 10 do pressKey("E") end end,
		["Civilains"] = function() move(workspace.Main["Mission Quest"]["4"]:GetChildren()[4].HumanoidRootPart.CFrame); for i = 1, 10 do pressKey("E") end end,
		["Goblet"] = function() move(CFrame.new(-4941.32715, 8.59784603, 3310.08887, 1, 0, 0, 0, 1, 0, 0, 0, 1)); for i = 1, 750 do pressKey("E") end; sGoblet = true end,
		["Shadow Portal"] = function() move(workspace.Main["Mission Quest"]["5"]:GetChildren()[4].CFrame); for i = 1, 750 do pressKey("E") end end,
		["Curse Spirit"] = function() autoMob("Curse Spirit", true) end,
		["Lightning Sorceror"] = function() autoMob("Kashimo", true) end,
	}

	for questName, action in pairs(questActions) do
		if questTitle:find(questName) then
			action()
			return
		end
	end
end

-- Farm Gems
local function runFarmGems()
	if not sGoblet then
		runAutoMission()
	else
		setBodyVelocity(false)
		local shopNpc
		pcall(function()
			shopNpc = workspace.Npc["Adventure Shop"]["Adventure Shop"]
		end)
		if shopNpc and shopNpc.HumanoidRootPart then
			shopNpc.HumanoidRootPart.ProximityPrompt.HoldDuration = 0
			move(shopNpc.HumanoidRootPart.CFrame)
			task.wait(0.1)
			pressKey("E")
			task.wait(0.1)
			local args = {[1] = "750"}
			pcall(function()
				LocalPlayer.PlayerGui:FindFirstChild("Adventure Store").Main.Iinv:FindFirstChild("{}").Events:FireServer(unpack(args))
			end)
			move(CFrame.new(-4941.32715, 8.59784603, 3310.08887, 1, 0, 0, 0, 1, 0, 0, 0, 1))
			task.wait(0.1)
			for i = 1, 770 do pressKey("E") end
			task.wait(3)
		end
	end
end

-- Auto Mission Toggle
Rey:CreateToggle(Exclusive, "Auto Mission (Lvl 1.000+)", "-", function(state)
	_G.AutoMissions = state
	for _, prompt in ipairs(workspace.Main["Mission Quest"]:GetDescendants()) do
		if prompt:IsA("ProximityPrompt") then prompt.HoldDuration = 0 end
	end
	setBodyVelocity(state)
	activeConnections["AutoMissions"] = _G.AutoMissions and RunService.Heartbeat:Connect(runAutoMission) or (activeConnections["AutoMissions"] and activeConnections["AutoMissions"]:Disconnect())
end)

-- Auto Mob
function autoMob(mob, state)
	if state then
		activeConnections["AutoMob" .. mob] = RunService.Heartbeat:Connect(function()
			if currentPriority == "Boss" or currentPriority == "VastoLorde" then return end

			local target = workspace.Main.Forest:FindFirstChild(mob)
			if target then
				local foundTarget = false
				for _, child in ipairs(target:GetChildren()) do
					if child:IsA("Model") and child:FindFirstChild("HumanoidRootPart") and child.Humanoid.Health > 0 then
						foundTarget = true
						setBodyVelocity(true)
						local targetPosition = child.HumanoidRootPart.Position + Vector3.new(0, child.HumanoidRootPart.Size.Y / 2 + 3, 0)
						move(CFrame.new(targetPosition, targetPosition - Vector3.new(0, 1, 0)))
						if selectedWeapon then
							selectedWeapon.Parent = LocalPlayer.Character
							selectedWeapon:Activate()
						end
						break
					end
				end
				if not foundTarget then
					setBodyVelocity(false)
				end
			else
				autoMob(mob, false)
				setBodyVelocity(false)
			end
		end)
	else
		if activeConnections["AutoMob" .. mob] then
			activeConnections["AutoMob" .. mob]:Disconnect()
			activeConnections["AutoMob" .. mob] = nil
			setBodyVelocity(false)
		end
	end
end

-- Adventure Shop Teleport
Rey:CreateButton(Exclusive, "Adventure Shop", "kalo ga ke tp berarti gada", "Teleport", function()
	local shopNpc
	pcall(function()
		shopNpc = workspace.Npc["Adventure Shop"]["Adventure Shop"]
	end)
	if shopNpc and shopNpc.HumanoidRootPart then
		move(shopNpc.HumanoidRootPart.CFrame)
	end
end)

-- Farm Gems Toggle
Rey:CreateToggle(Exclusive, "Farm Gems", "jual sendiri Goblet nya wakðŸ˜¹ðŸ˜¹", function(state)
	_G.FarmGems = state
	for _, prompt in ipairs(workspace.Main["Mission Quest"]:GetDescendants()) do
		if prompt:IsA("ProximityPrompt") then prompt.HoldDuration = 0 end
	end
	setBodyVelocity(state)
	activeConnections["FarmGems"] = _G.AutoMissions and RunService.Heartbeat:Connect(runFarmGems) or (activeConnections["FarmGems"] and activeConnections["FarmGems"]:Disconnect())
end)

-- Auto Goblet (Manual Click)
Rey:CreateButton(Exclusive, "Auto Goblet [Manual Click]", "farm diamond cik", "Start", function()
	move(CFrame.new(-4941.32715, 8.59784603, 3310.08887, 1, 0, 0, 0, 1, 0, 0, 0, 1))
	task.wait(0.1)
	for i = 1, 750 do pressKey("E") end
end)

-- Auto Buy Black Merchant (Slow)
Rey:CreateToggle(Exclusive, "Auto Buy Black Merchant (Slow)", "Auto TP, Auto Buy", function(state)
	_G.AutoBM1 = state
	activeConnections["AutoBM1"] = _G.AutoBM1 and RunService.Heartbeat:Connect(function()
		local merchantNpc
		pcall(function()
			merchantNpc = workspace.Npc["Black Merchant"]["Black Merchant"]
		end)
		if _G.AutoBM1 and merchantNpc and merchantNpc.HumanoidRootPart then
			setBodyVelocity(true)
			move(merchantNpc.HumanoidRootPart.CFrame)
			pressKey("E")
		else
			setBodyVelocity(false)
		end
	end) or (activeConnections["AutoBM1"] and activeConnections["AutoBM1"]:Disconnect())
end)

-- Auto Buy Black Merchant (Fast)
Rey:CreateToggle(Exclusive, "Auto Buy Black Merchant (Fast)", "kalo lag ga nanggung", function(state)
	_G.AutoBM2 = state
	activeConnections["AutoBM2"] = _G.AutoBM2 and RunService.Heartbeat:Connect(function()
		local merchantNpc
		pcall(function()
			merchantNpc = workspace.Npc["Black Merchant"]["Black Merchant"]
		end)
		if _G.AutoBM2 and merchantNpc and merchantNpc.HumanoidRootPart then
			setBodyVelocity(true)
			move(merchantNpc.HumanoidRootPart.CFrame)
			for i=1, 100 then pressKey("E") end
		else
			setBodyVelocity(false)
		end
	end) or (activeConnections["AutoBM2"] and activeConnections["AutoBM2"]:Disconnect())
end)

-- Auto Buy Black Merchant (BROKEN)
Rey:CreateToggle(Exclusive, "Auto Buy Black Merchant (BROKEN)", "ðŸ’€ðŸ’€", function(state)
	_G.AutoBM3 = state
	activeConnections["AutoBM3"] = _G.AutoBM3 and RunService.Heartbeat:Connect(function()
		local merchantNpc
		pcall(function()
			merchantNpc = workspace.Npc["Black Merchant"]["Black Merchant"]
		end)
		if _G.AutoBM3 and merchantNpc and merchantNpc.HumanoidRootPart then
			setBodyVelocity(true)
			move(merchantNpc.HumanoidRootPart.CFrame)
			for i = 1, 1000 do pressKey("E") end
		else
			setBodyVelocity(false)
		end
	end) or (activeConnections["AutoBM3"] and activeConnections["AutoBM3"]:Disconnect())
end)
